<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div data-testid="online-user" id="user-name"></div>
    <input data-testid="nickname-box" id="input-nick">
    <button data-testid="nickname-button" id="change-nick">Enviar</button>
    <ul id="messages"></ul>
    <input data-testid="message-box" id="input">
    <button data-testid="send-button" id="send">Enviar</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"></script>
    <script>
        function createMessage(message) {
            const li = document.createElement('li');
            li.innerText = message;
            li.setAttribute('data-testid', 'message');
            return li;
        }
        socket = io();
        socket.on('messages', (messages) => {
            const messagesElements = messages.map((message) => createMessage(message));
            document.getElementById('messages').append(...messagesElements);
        });
        document.getElementById('send').addEventListener('click', () => {
            const chatMessage = document.getElementById('input').value;
            const nickname = document.getElementById('user-name').innerText;
            socket.emit('message', {
                chatMessage,
                nickname,
            });
        });
        document.getElementById('change-nick').addEventListener('click', () => {
            const newNickname = document.getElementById('input-nick').value;
            document.getElementById('user-name').innerText = newNickname;
        });
        socket.on('message', (message) => {
            const li = createMessage(message);
            document.getElementById('messages').append(li);
        });
        const randomName = Math.random().toString().replace('.', '').slice(0, 16);
        document.getElementById('user-name').innerText = randomName;
    </script>
</body>
</html>